<!--
 * @Author: quling
 * @Date: 2023-12-29 09:29:13
 * @LastEditors: quling
 * @LastEditTime: 2023-12-29 15:11:36
 * @Description: 
 * @FilePath: \supermap-webGL\examples\7_Property.html
-->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Property的使用及其原理</title>
  <link href="../lib/Build/SuperMap3D/Widgets/widgets.css" rel="stylesheet">
  <link rel="stylesheet" href="../lib/css/pretty.css">
  <link rel="stylesheet" href="../lib/css/bootstrap.min.css">
  <script type="text/javascript" src="../lib/js/tooltip.js"></script>
  <script type="text/javascript" src="../lib/js/jquery.min.js"></script>
  <script type="text/javascript" src="../lib/Build/SuperMap3D/SuperMap3D.js"></script>
  <script type="text/javascript" src="../lib/js/config.js"></script>
  <style>
    body {
      position: relative;

    }

    .operation {
      position: absolute;
      top: 0;
      left: 0;
      z-index: 1;
    }

    #Container {
      background-size: cover;
      width: 100%;
      height: 100%;
    }

    /* 设置光标样式 */
    .drawCur {
      cursor: url("../assets/cur/draw.cur"), auto !important;
    }
  </style>
</head>

<body>
  <div class="operation">
    <button id="SampledProperty" class="button black">SampledProperty-线性变化</button>
    <button id="TimeIntervalCollectionProperty" class="button black">TimeIntervalCollectionProperty-跳跃变化</button>
    <button id="CompositeProperty" class="button black">CompositeProperty-组合变化</button>
    <button id="current" class="button black">获取box</button>
    <button id="del" class="button black">删除box</button>
  </div>
  <div id="Container"></div>

  <script type="text/javascript">
    let viewer = null
    let scene = null
    let camera = null
    let height = 500000.0
    let blueBox = null

    function onload(SuperMap3D) {
      viewer = new SuperMap3D.Viewer('Container', {
        // 取消信息提示框
        infoBox: false,
      });
      scene = viewer.scene;
      camera = viewer.camera;

      // 创建盒子
      blueBox = viewer.entities.add({
        id: 'box',
        name: 'Blue box',
        position: SuperMap3D.Cartesian3.fromDegrees(-114.0, 40.0, 300000.0),
        box: {
          // dimensions: new SuperMap3D.Cartesian3(400000.0, 300000.0, height),
          // 上面的写法等同于下面的写法
          dimensions: new SuperMap3D.ConstantProperty(new SuperMap3D.Cartesian3(400000.0, 300000.0, height)),
          material: SuperMap3D.Color.BLUE,
          outline: true,
        }
      });

      viewer.flyTo(blueBox)
    }
    onload(SuperMap3D);

    // 获取当前box-判断entity是否还存在
    $("#current").click(() => {
      console.log("current", blueBox, viewer.entities.contains(blueBox));
    })

    $("#del").click(() => {
      viewer.entities.remove(blueBox)
    })

    // 通过定时器改变box高度-ConstantProperty
    function changeHeightBySetInterval() {
      // 通过setInterval-盒子高度增加
      setInterval(function () {
        height += 50000
        // blueBox.box.dimensions = new SuperMap3D.Cartesian3(400000.0, 300000.0, height); // 创建一个新的ConstantProperty

        // 也可以通过下面的写法修改,效果相同

        blueBox.box.dimensions.setValue(new SuperMap3D.Cartesian3(400000.0, 300000.0, height)); // 修改原有的ConstantProperty的值
      }, 3000);
    }

    // 通过Property实现-SampledProperty-线性变化-2s过后虽然看不见box了,但box并没有被删除,仍然存在EntityCollection中
    $("#SampledProperty").click(() => {
      const property = SampledProperty()
      blueBox.box.dimensions = property;

      // 颜色线性变化
      const colorProperty = new SuperMap3D.SampledProperty(SuperMap3D.Color);
      // 当前时间
      const date = new Date()
      const start = new Date(date.getTime())
      // 2s后的时间
      const stop = new Date(date.getTime() + 2000)
      colorProperty.addSample(SuperMap3D.JulianDate.fromDate(start),
        SuperMap3D.Color.DEEPPINK);
      colorProperty.addSample(SuperMap3D.JulianDate.fromDate(stop),
        SuperMap3D.Color.AQUAMARINE);
      blueBox.box.material = new SuperMap3D.ColorMaterialProperty(colorProperty);
    })
    /**
     * @description: 线性变化设置
     * @param {*} i 间隔时间,避免组合变化时间出现时间重叠
     * @return {*}
     */
    function SampledProperty(i = 0) {
      // SampledProperty：用来通过给定多个不同时间点的Sample，然后在每两个时间点之间进行线性插值的一种Property
      const property = new SuperMap3D.SampledProperty(SuperMap3D.Cartesian3);

      // 当前时间
      const date = new Date()
      const start = new Date(date.getTime() + i * 2000)
      // 2s后的时间
      const stop = new Date(date.getTime() + (i + 1) * 2000)

      // 在两个不同的时间点分别赋予不同的属性
      property.addSample(SuperMap3D.JulianDate.fromDate(start),
        new SuperMap3D.Cartesian3(400000.0, 300000.0, height));
      property.addSample(SuperMap3D.JulianDate.fromDate(stop),
        new SuperMap3D.Cartesian3(400000.0, 300000.0, height * 2));

      return property
    }

    // 通过Property实现-TimeIntervalCollectionProperty-跳跃变化
    $("#TimeIntervalCollectionProperty").click(() => {
      const property = TimeIntervalCollectionProperty()
      blueBox.box.dimensions = property
    })
    /**
     * @description: 跳跃变化设置--每2s高度增加20000
     * @param {*} count 设置几次跳跃变化
     * @return {*}
     */
    function TimeIntervalCollectionProperty(count = 5) {
      const timeIntervalProperty = new SuperMap3D.TimeIntervalCollectionProperty(SuperMap3D.Cartesian3);
      // 当前时间
      const current = SuperMap3D.JulianDate.fromDate(new Date())
      for (let i = 0; i < count; i++) {
        const start = SuperMap3D.JulianDate.addSeconds(current, i * 2, new SuperMap3D.JulianDate())
        // 2s后的时间
        const stop = SuperMap3D.JulianDate.addSeconds(current, (i + 1) * 2, new SuperMap3D.JulianDate())

        // 时间区间为左闭右开
        const timeInterval = new SuperMap3D.TimeInterval({
          // 间隔的开始时间
          start,
          // 间隔的停止时间
          stop,
          // start是否包含在间隔中
          isStartIncluded: true,
          // stop是否包含在间隔中
          isStopIncluded: false,
          // 此间隔关联的任意数据
          data: new SuperMap3D.Cartesian3(400000.0, 300000.0, height)
        });
        height += 20000

        timeIntervalProperty.intervals.addInterval(timeInterval)
      }

      return timeIntervalProperty
    }

    // 通过Property实现-CompositeProperty-组合变化
    // 如果出现时间重叠的部分,那个变化后设置,就执行那个
    $("#CompositeProperty").click(() => {
      const composite = new SuperMap3D.CompositeProperty();
      // 设置静态变化Property
      const constantProperty = new SuperMap3D.ConstantProperty(new SuperMap3D.Cartesian3(400000.0, 300000.0, height))

      composite.intervals.addInterval(SuperMap3D.TimeInterval.fromIso8601({
        iso8601: '2023-12-29T00:00:00.00Z/2023-12-30T00:00:00.00Z',
        data: constantProperty
      }));

      // 设置跳跃变化Property
      const timeIntervalProperty = TimeIntervalCollectionProperty(2)
      // 设置线性变化Property
      const sampleProperty = SampledProperty(3)

      // 当前时间
      let date = new Date()
      let date_ = new Date(date.getTime() + 4000)

      composite.intervals.addInterval(new SuperMap3D.TimeInterval({
        // 间隔的开始时间
        start: SuperMap3D.JulianDate.fromDate(date),
        // 间隔的停止时间
        stop: SuperMap3D.JulianDate.fromDate(date_),
        // start是否包含在间隔中
        isStartIncluded: true,
        // stop是否包含在间隔中
        isStopIncluded: false,
        // 此间隔关联的任意数据
        data: timeIntervalProperty
      }));

      // 时间设置
      date = new Date(date.getTime() + 6000)
      date_ = new Date(date.getTime() + 8000)

      composite.intervals.addInterval(new SuperMap3D.TimeInterval({
        // 间隔的开始时间
        start: SuperMap3D.JulianDate.fromDate(date),
        // 间隔的停止时间
        stop: SuperMap3D.JulianDate.fromDate(date_),
        // start是否包含在间隔中
        isStartIncluded: true,
        // stop是否包含在间隔中
        isStopIncluded: false,
        // 此间隔关联的任意数据
        data: sampleProperty
      }));

      blueBox.box.dimensions = composite
    })
  </script>
</body>

</html>