define(["exports","./Cartographic-cd471038","./when-f4cab1fd","./Check-5cf5e906","./Cartesian2-94d75d5d","./EllipsoidGeodesic-1fd478b9","./EllipsoidRhumbLine-f8cea347","./IntersectionTests-74b7d43a","./Math-d934ba6b","./FeatureDetection-fb5abd84","./Plane-07f90ae1"],(function(r,e,a,t,n,o,i,c,s,u,h){"use strict";var f={numberOfPoints:function(r,a,t){var n=e.o.distance(r,a);return Math.ceil(n/t)},numberOfPointsRhumbLine:function(r,e,a){var t=Math.pow(r.longitude-e.longitude,2)+Math.pow(r.latitude-e.latitude,2);return Math.ceil(Math.sqrt(t/(a*a)))}},l=new e.a;f.extractHeights=function(r,e){for(var a=r.length,t=new Array(a),n=0;n<a;n++){var o=r[n];t[n]=e.cartesianToCartographic(o,l).height}return t};var g=new u.p,p=new e.o,v=new e.o,d=new h.o(e.o.UNIT_X,0),m=new e.o,w=new h.o(e.o.UNIT_X,0),T=new e.o,y=new e.o,P=[];function A(r,e,a){var t,n=P;if(n.length=r,e===a){for(t=0;t<r;t++)n[t]=e;return n}var o=(a-e)/r;for(t=0;t<r;t++){var i=e+t*o;n[t]=i}return n}var b=new e.a,C=new e.a,S=new e.o,E=new e.o,R=new e.o,D=new o.E,G=new i.P;function N(r,a,t,n,o,i,c,s,u){var h=n.scaleToGeodeticSurface(r,E),l=n.scaleToGeodeticSurface(a,R),g=f.numberOfPoints(r,a,t),p=n.cartesianToCartographic(h,b),v=n.cartesianToCartographic(l,C),d=A(g,o,i);u>0&&(d=function(r,e){var a=P;a.length=r;for(var t=0;t<r;t++)a[t]+=e*Math.sin(Math.PI*t/r);return a}(g,u)),D.setEndPoints(p,v);var m=D.surfaceDistance/g,w=s;p.height=o;var T=n.cartographicToCartesian(p,S);e.o.pack(T,c,w),w+=3;for(var y=1;y<g;y++){var G=D.interpolateUsingSurfaceDistance(y*m,C);G.height=d[y],T=n.cartographicToCartesian(G,S),e.o.pack(T,c,w),w+=3}return w}function I(r,a,t,n,o,c,s,u){var h=n.scaleToGeodeticSurface(r,E),l=n.scaleToGeodeticSurface(a,R),g=n.cartesianToCartographic(h,b),p=n.cartesianToCartographic(l,C),v=f.numberOfPointsRhumbLine(g,p,t),d=A(v,o,c);G.ellipsoid.equals(n)||(G=new i.P(void 0,void 0,n)),G.setEndPoints(g,p);var m=G.surfaceDistance/v,w=u;g.height=o;var T=n.cartographicToCartesian(g,S);e.o.pack(T,s,w),w+=3;for(var y=1;y<v;y++){var P=G.interpolateUsingSurfaceDistance(y*m,C);P.height=d[y],T=n.cartographicToCartesian(P,S),e.o.pack(T,s,w),w+=3}return w}f.wrapLongitude=function(r,t){var n=[],o=[];if(a.e(r)&&r.length>0){t=a.u(t,u.p.IDENTITY);var i=u.p.inverseTransformation(t,g),s=u.p.multiplyByPoint(i,e.o.ZERO,p),f=e.o.normalize(u.p.multiplyByPointAsVector(i,e.o.UNIT_Y,v),v),l=h.o.fromPointNormal(s,f,d),P=e.o.normalize(u.p.multiplyByPointAsVector(i,e.o.UNIT_X,m),m),A=h.o.fromPointNormal(s,P,w),b=1;n.push(e.o.clone(r[0]));for(var C=n[0],S=r.length,E=1;E<S;++E){var R=r[E];if(h.o.getPointDistance(A,C)<0||h.o.getPointDistance(A,R)<0){var D=c.g.lineSegmentPlane(C,R,l,T);if(a.e(D)){var G=e.o.multiplyByScalar(f,5e-9,y);h.o.getPointDistance(l,C)<0&&e.o.negate(G,G),n.push(e.o.add(D,G,new e.o)),o.push(b+1),e.o.negate(G,G),n.push(e.o.add(D,G,new e.o)),b=1}}n.push(e.o.clone(r[E])),b++,C=R}o.push(b)}return{positions:n,lengths:o}},f.generateArc=function(r){a.e(r)||(r={});var o=r.positions;if(!a.e(o))throw new t.t("options.positions is required.");var i=o.length,c=a.u(r.ellipsoid,n.t.WGS84),u=a.u(r.height,0),h=Array.isArray(u);if(i<1)return[];if(1===i){var l=c.scaleToGeodeticSurface(o[0],E);if(0!==(u=h?u[0]:u)){var g=c.geodeticSurfaceNormal(l,S);e.o.multiplyByScalar(g,u,g),e.o.add(l,g,l)}return[l.x,l.y,l.z]}var p=r.minDistance;if(!a.e(p)){var v=a.u(r.granularity,s.e.RADIANS_PER_DEGREE);p=s.e.chordLength(v,c.maximumRadius)}var d,m=0;for(d=0;d<i-1;d++)m+=f.numberOfPoints(o[d],o[d+1],p);var w=r.hMax,T=3*(m+1),y=new Array(T),A=0;for(d=0;d<i-1;d++){A=N(o[d],o[d+1],p,c,h?u[d]:u,h?u[d+1]:u,y,A,w)}P.length=0;var C=o[i-1],R=c.cartesianToCartographic(C,b);R.height=h?u[i-1]:u;var D=c.cartographicToCartesian(R,S);return e.o.pack(D,y,T-3),y};var k=new e.a,M=new e.a;f.generateRhumbArc=function(r){a.e(r)||(r={});var o=r.positions;if(!a.e(o))throw new t.t("options.positions is required.");var i=o.length,c=a.u(r.ellipsoid,n.t.WGS84),u=a.u(r.height,0),h=Array.isArray(u);if(i<1)return[];if(1===i){var l=c.scaleToGeodeticSurface(o[0],E);if(0!==(u=h?u[0]:u)){var g=c.geodeticSurfaceNormal(l,S);e.o.multiplyByScalar(g,u,g),e.o.add(l,g,l)}return[l.x,l.y,l.z]}var p,v,d=a.u(r.granularity,s.e.RADIANS_PER_DEGREE),m=0,w=c.cartesianToCartographic(o[0],k);for(p=0;p<i-1;p++)v=c.cartesianToCartographic(o[p+1],M),m+=f.numberOfPointsRhumbLine(w,v,d),w=e.a.clone(v,k);var T=3*(m+1),y=new Array(T),A=0;for(p=0;p<i-1;p++){A=I(o[p],o[p+1],d,c,h?u[p]:u,h?u[p+1]:u,y,A)}P.length=0;var C=o[i-1],R=c.cartesianToCartographic(C,b);R.height=h?u[i-1]:u;var D=c.cartographicToCartesian(R,S);return e.o.pack(D,y,T-3),y},f.generateCartesianArc=function(r){for(var a=f.generateArc(r),t=a.length/3,n=new Array(t),o=0;o<t;o++)n[o]=e.o.unpack(a,3*o);return n},f.generateCartesianRhumbArc=function(r){for(var a=f.generateRhumbArc(r),t=a.length/3,n=new Array(t),o=0;o<t;o++)n[o]=e.o.unpack(a,3*o);return n},r.m=f}));
