define(["exports","./ArcType-31298545","./arrayRemoveDuplicates-cf1d78b2","./Cartesian2-94d75d5d","./Cartographic-cd471038","./ComponentDatatype-509ef64d","./when-f4cab1fd","./EllipsoidRhumbLine-f8cea347","./GeometryAttribute-acc7fc74","./GeometryAttributes-dfda2cfe","./GeometryPipeline-3545e16b","./IndexDatatype-1cff6ae5","./Math-d934ba6b","./FeatureDetection-fb5abd84","./PolygonPipeline-846242d7"],(function(e,t,r,o,n,i,a,s,u,h,c,l,f,p,v){"use strict";function d(){this._array=[],this._offset=0,this._length=0}Object.defineProperties(d.prototype,{length:{get:function(){return this._length}}}),d.prototype.enqueue=function(e){this._array.push(e),this._length++},d.prototype.dequeue=function(){if(0!==this._length){var e=this._array,t=this._offset,r=e[t];return e[t]=void 0,++t>10&&2*t>e.length&&(this._array=e.slice(t),t=0),this._offset=t,this._length--,r}},d.prototype.peek=function(){if(0!==this._length)return this._array[this._offset]},d.prototype.contains=function(e){return-1!==this._array.indexOf(e)},d.prototype.clear=function(){this._array.length=this._offset=this._length=0},d.prototype.sort=function(e){this._offset>0&&(this._array=this._array.slice(this._offset),this._offset=0),this._array.sort(e)};var g={computeHierarchyPackedLength:function(e){for(var t=0,r=[e];r.length>0;){var o=r.pop();if(a.e(o)){t+=2;var i=o.positions,s=o.holes;if(a.e(i)&&(t+=i.length*n.o.packedLength),a.e(s))for(var u=s.length,h=0;h<u;++h)r.push(s[h])}}return t},packPolygonHierarchy:function(e,t,r){for(var o=[e];o.length>0;){var i=o.pop();if(a.e(i)){var s=i.positions,u=i.holes;if(t[r++]=a.e(s)?s.length:0,t[r++]=a.e(u)?u.length:0,a.e(s))for(var h=s.length,c=0;c<h;++c,r+=3)n.o.pack(s[c],t,r);if(a.e(u))for(var l=u.length,f=0;f<l;++f)o.push(u[f])}}return r},unpackPolygonHierarchy:function(e,t){for(var r=e[t++],o=e[t++],i=new Array(r),a=o>0?new Array(o):void 0,s=0;s<r;++s,t+=n.o.packedLength)i[s]=n.o.unpack(e,t);for(var u=0;u<o;++u)a[u]=g.unpackPolygonHierarchy(e,t),t=a[u].startingIndex,delete a[u].startingIndex;return{positions:i,holes:a,startingIndex:t}}},y=new n.o;function m(e,t,r,o){return n.o.subtract(t,e,y),n.o.multiplyByScalar(y,r/o,y),n.o.add(e,y,y),[y.x,y.y,y.z]}g.subdivideLineCount=function(e,t,r){var o=n.o.distance(e,t)/r,i=Math.max(0,Math.ceil(f.e.log2(o)));return Math.pow(2,i)};var b=new n.a,I=new n.a,w=new n.a,_=new n.o;g.subdivideRhumbLineCount=function(e,t,r,o){var n=e.cartesianToCartographic(t,b),i=e.cartesianToCartographic(r,I),a=new s.P(n,i,e).surfaceDistance/o,u=Math.max(0,Math.ceil(f.e.log2(a)));return Math.pow(2,u)},g.subdivideLine=function(e,t,r,o){var i=g.subdivideLineCount(e,t,r),s=n.o.distance(e,t),u=s/i;a.e(o)||(o=[]);var h=o;h.length=3*i;for(var c=0,l=0;l<i;l++){var f=m(e,t,l*u,s);h[c++]=f[0],h[c++]=f[1],h[c++]=f[2]}return h},g.subdivideRhumbLine=function(e,t,r,o,n){var i=e.cartesianToCartographic(t,b),u=e.cartesianToCartographic(r,I),h=new s.P(i,u,e),c=h.surfaceDistance/o,l=Math.max(0,Math.ceil(f.e.log2(c))),p=Math.pow(2,l),v=h.surfaceDistance/p;a.e(n)||(n=[]);var d=n;d.length=3*p;for(var g=0,y=0;y<p;y++){var m=h.interpolateUsingSurfaceDistance(y*v,w),L=e.cartographicToCartesian(m,_);d[g++]=L.x,d[g++]=L.y,d[g++]=L.z}return d};var L=new n.o,x=new n.o,E=new n.o,D=new n.o;g.scaleToGeodeticHeightExtruded=function(e,t,r,i,s){i=a.u(i,o.t.WGS84);var u=L,h=x,c=E,l=D;if(a.e(e)&&a.e(e.attributes)&&a.e(e.attributes.position))for(var f=e.attributes.position.values,p=f.length/2,v=0;v<p;v+=3)n.o.fromArray(f,v,c),i.geodeticSurfaceNormal(c,u),l=i.scaleToGeodeticSurface(c,l),h=n.o.multiplyByScalar(u,r,h),h=n.o.add(l,h,h),f[v+p]=h.x,f[v+1+p]=h.y,f[v+2+p]=h.z,s&&(l=n.o.clone(c,l)),h=n.o.multiplyByScalar(u,t,h),h=n.o.add(l,h,h),f[v]=h.x,f[v+1]=h.y,f[v+2]=h.z;return e},g.polygonOutlinesFromHierarchy=function(e,t,o){var i,s,u,h=[],c=new d;for(c.enqueue(e);0!==c.length;){var l=c.dequeue(),f=l.positions;if(t)for(u=f.length,i=0;i<u;i++)o.scaleToGeodeticSurface(f[i],f[i]);if(!((f=r.D(f,n.o.equalsEpsilon,!0)).length<3)){var p=l.holes?l.holes.length:0;for(i=0;i<p;i++){var v=l.holes[i],g=v.positions;if(t)for(u=g.length,s=0;s<u;++s)o.scaleToGeodeticSurface(g[s],g[s]);if(!((g=r.D(g,n.o.equalsEpsilon,!0)).length<3)){h.push(g);var y=0;for(a.e(v.holes)&&(y=v.holes.length),s=0;s<y;s++)c.enqueue(v.holes[s])}}h.push(f)}}return h};var S=new n.o(6378137,6378137,6378137);g.polygonsFromHierarchy=function(e,t,o,i){var s=[],u=[],h=new d;for(h.enqueue(e);0!==h.length;){var c,l,p,g=h.dequeue(),y=g.positions,m=g.holes,b=y.slice();if(o)for(l=y.length,c=0;c<l;c++)i.scaleToGeodeticSurface(y[c],b[c]);if(a.e(i)&&!n.o.equals(i._radii,S)&&(p=f.e.EPSILON7),!((y=r.D(b,n.o.equalsEpsilon,!0,p)).length<3)){var I=t(y);if(a.e(I)){var w=[],_=v.A.computeWindingOrder2D(I);_===v.W.CLOCKWISE&&(I.reverse(),y=y.slice().reverse());var L,x=y.slice(),E=a.e(m)?m.length:0,D=[];for(c=0;c<E;c++){var A=m[c],T=A.positions;if(o)for(l=T.length,L=0;L<l;++L)i.scaleToGeodeticSurface(T[L],T[L]);if(!((T=r.D(T,n.o.equalsEpsilon,!0,f.e.EPSILON7)).length<3)){var C=t(T);if(a.e(C)){(_=v.A.computeWindingOrder2D(C))===v.W.CLOCKWISE&&(C.reverse(),T=T.slice().reverse()),D.push(T),w.push(x.length),x=x.concat(T),I=I.concat(C);var N=0;for(a.e(A.holes)&&(N=A.holes.length),L=0;L<N;L++)h.enqueue(A.holes[L])}}}s.push({outerRing:y,holes:D}),u.push({positions:x,positions2D:I,holes:w})}}}return{hierarchy:s,polygons:u}};var A=new o.o,T=new n.o,C=new u.n,N=new p.p$1;g.computeBoundingRectangle=function(e,t,r,o,i){for(var s=u.n.fromAxisAngle(e,o,C),h=p.p$1.fromQuaternion(s,N),c=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY,f=Number.POSITIVE_INFINITY,v=Number.NEGATIVE_INFINITY,d=r.length,g=0;g<d;++g){var y=n.o.clone(r[g],T);p.p$1.multiplyByVector(h,y,y);var m=t(y,A);a.e(m)&&(c=Math.min(c,m.x),l=Math.max(l,m.x),f=Math.min(f,m.y),v=Math.max(v,m.y))}return i.x=c,i.y=f,i.width=l-c,i.height=v-f,i},g.createGeometryFromPositions=function(e,r,o,n,a,s){var h=v.A.triangulate(r.positions2D,r.holes);h.length<3&&(h=[0,1,2]);var l=r.positions;if(n){for(var f=l.length,d=new Array(3*f),g=0,y=0;y<f;y++){var m=l[y];d[g++]=m.x,d[g++]=m.y,d[g++]=m.z}var b=new u.I({attributes:{position:new u.o({componentDatatype:i.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:d})},indices:h,primitiveType:p._0x5962b7.TRIANGLES});return a.normal?c.k.computeNormal(b):b}return s===t.L.GEODESIC?v.A.computeSubdivision(e,l,h,o):s===t.L.RHUMB?v.A.computeRhumbLineSubdivision(e,l,h,o):void 0};var G=[],P=new n.o,O=new n.o;g.computeWallGeometry=function(e,r,o,a,s){var c,v,d,y,m,b=e.length,I=0;if(a)for(v=3*b*2,c=new Array(2*v),d=0;d<b;d++)y=e[d],m=e[(d+1)%b],c[I]=c[I+v]=y.x,c[++I]=c[I+v]=y.y,c[++I]=c[I+v]=y.z,c[++I]=c[I+v]=m.x,c[++I]=c[I+v]=m.y,c[++I]=c[I+v]=m.z,++I;else{var w=f.e.chordLength(o,r.maximumRadius),_=0;if(s===t.L.GEODESIC)for(d=0;d<b;d++)_+=g.subdivideLineCount(e[d],e[(d+1)%b],w);else if(s===t.L.RHUMB)for(d=0;d<b;d++)_+=g.subdivideRhumbLineCount(r,e[d],e[(d+1)%b],w);for(v=3*(_+b),c=new Array(2*v),d=0;d<b;d++){var L;y=e[d],m=e[(d+1)%b],s===t.L.GEODESIC?L=g.subdivideLine(y,m,w,G):s===t.L.RHUMB&&(L=g.subdivideRhumbLine(r,y,m,w,G));for(var x=L.length,E=0;E<x;++E,++I)c[I]=L[E],c[I+v]=L[E];c[I]=m.x,c[I+v]=m.x,c[++I]=m.y,c[I+v]=m.y,c[++I]=m.z,c[I+v]=m.z,++I}}b=c.length;var D=l.IndexDatatype.createTypedArray(b/3,b-6*e.length),S=0;for(b/=6,d=0;d<b;d++){var A=d,T=A+1,C=A+b,N=C+1;y=n.o.fromArray(c,3*A,P),m=n.o.fromArray(c,3*T,O),!n.o.equalsEpsilon(y,m,f.e.EPSILON10,f.e.EPSILON10)&&(D[S++]=A,D[S++]=C,D[S++]=T,D[S++]=T,D[S++]=C,D[S++]=N)}return new u.I({attributes:new h.a({position:new u.o({componentDatatype:i.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:c})}),indices:D,primitiveType:p._0x5962b7.TRIANGLES})},e.y=g}));
