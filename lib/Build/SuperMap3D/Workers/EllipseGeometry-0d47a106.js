define(["exports","./arrayFill-502e07db","./buildModuleUrl-f27f6c2c","./Cartesian2-94d75d5d","./Cartographic-cd471038","./Check-5cf5e906","./ComponentDatatype-509ef64d","./when-f4cab1fd","./EllipseGeometryLibrary-5792c41f","./GeometryAttribute-49ca40d9","./GeometryAttributes-dfda2cfe","./GeometryInstance-2fd7096a","./GeometryOffsetAttribute-b4d599f5","./GeometryPipeline-92984d25","./IndexDatatype-1cff6ae5","./Math-d934ba6b","./FeatureDetection-b966c0a3","./VertexFormat-8d99016a"],(function(t,e,o,r,n,i,a,s,u,m,l,c,p,d,y,f,h,A){"use strict";var x=new n.o,g=new n.o,_=new n.o,v=new n.o,b=new r.o,w=new h.p$1,I=new h.p$1,T=new m.n,N=new n.o,M=new n.o,E=new n.o,P=new n.a,D=new n.o,F=new r.o,O=new r.o;function S(t,i,c){var d=i.vertexFormat,y=i.center,f=i.semiMajorAxis,A=i.semiMinorAxis,v=i.ellipsoid,S=i.stRotation,C=c?t.length/3*2:t.length/3,L=i.shadowVolume,R=d.st?new Float32Array(2*C):void 0,j=d.normal?new Float32Array(3*C):void 0,z=d.tangent?new Float32Array(3*C):void 0,G=d.bitangent?new Float32Array(3*C):void 0,V=L?new Float32Array(3*C):void 0,k=0,Y=N,B=M,H=E,$=new o.n(v),U=$.project(v.cartesianToCartographic(y,P),D),W=v.scaleToGeodeticSurface(y,x);v.geodeticSurfaceNormal(W,W);var q=w,Q=I;if(0!==S){var J=m.n.fromAxisAngle(W,S,T);q=h.p$1.fromQuaternion(J,q),J=m.n.fromAxisAngle(W,-S,T),Q=h.p$1.fromQuaternion(J,Q)}else q=h.p$1.clone(h.p$1.IDENTITY,q),Q=h.p$1.clone(h.p$1.IDENTITY,Q);for(var Z=r.o.fromElements(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,F),K=r.o.fromElements(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,O),X=t.length,tt=c?X:0,et=tt/3*2,ot=0;ot<X;ot+=3){var rt=ot+1,nt=ot+2,it=n.o.fromArray(t,ot,x);if(d.st){var at=h.p$1.multiplyByVector(q,it,g),st=$.project(v.cartesianToCartographic(at,P),_);n.o.subtract(st,U,st),b.x=(st.x+f)/(2*f),b.y=(st.y+A)/(2*A),Z.x=Math.min(b.x,Z.x),Z.y=Math.min(b.y,Z.y),K.x=Math.max(b.x,K.x),K.y=Math.max(b.y,K.y),c&&(R[k+et]=b.x,R[k+1+et]=b.y),R[k++]=b.x,R[k++]=b.y}(d.normal||d.tangent||d.bitangent||L)&&(Y=v.geodeticSurfaceNormal(it,Y),L&&(V[ot+tt]=-Y.x,V[rt+tt]=-Y.y,V[nt+tt]=-Y.z),(d.normal||d.tangent||d.bitangent)&&((d.tangent||d.bitangent)&&(B=n.o.normalize(n.o.cross(n.o.UNIT_Z,Y,B),B),h.p$1.multiplyByVector(Q,B,B)),d.normal&&(j[ot]=Y.x,j[rt]=Y.y,j[nt]=Y.z,c&&(j[ot+tt]=-Y.x,j[rt+tt]=-Y.y,j[nt+tt]=-Y.z)),d.tangent&&(z[ot]=B.x,z[rt]=B.y,z[nt]=B.z,c&&(z[ot+tt]=-B.x,z[rt+tt]=-B.y,z[nt+tt]=-B.z)),d.bitangent&&(H=n.o.normalize(n.o.cross(Y,B,H),H),G[ot]=H.x,G[rt]=H.y,G[nt]=H.z,c&&(G[ot+tt]=H.x,G[rt+tt]=H.y,G[nt+tt]=H.z))))}if(d.st){X=R.length;for(var ut=0;ut<X;ut+=2)R[ut]=(R[ut]-Z.x)/(K.x-Z.x),R[ut+1]=(R[ut+1]-Z.y)/(K.y-Z.y)}var mt=new l.a;if(d.position){var lt=u.C.raisePositionsToHeight(t,i,c);mt.position=new m.o({componentDatatype:a.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:lt})}if(d.st&&(mt.st=new m.o({componentDatatype:a.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:R})),d.normal&&(mt.normal=new m.o({componentDatatype:a.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:j})),d.tangent&&(mt.tangent=new m.o({componentDatatype:a.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:z})),d.bitangent&&(mt.bitangent=new m.o({componentDatatype:a.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:G})),L&&(mt.extrudeDirection=new m.o({componentDatatype:a.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:V})),c&&s.e(i.offsetAttribute)){var ct=new Uint8Array(C);if(i.offsetAttribute===p.z.TOP)ct=e.d(ct,1,0,C/2);else{var pt=i.offsetAttribute===p.z.NONE?0:1;ct=e.d(ct,pt)}mt.applyOffset=new m.o({componentDatatype:a.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:ct})}return mt}function C(t){var e,o,r,n,i,a=new Array(t*(t+1)*12-6),s=0;for(e=0,r=1,n=0;n<3;n++)a[s++]=r++,a[s++]=e,a[s++]=r;for(n=2;n<t+1;++n){for(r=n*(n+1)-1,e=(n-1)*n-1,a[s++]=r++,a[s++]=e,a[s++]=r,o=2*n,i=0;i<o-1;++i)a[s++]=r,a[s++]=e++,a[s++]=e,a[s++]=r++,a[s++]=e,a[s++]=r;a[s++]=r++,a[s++]=e,a[s++]=r}for(o=2*t,++r,++e,n=0;n<o-1;++n)a[s++]=r,a[s++]=e++,a[s++]=e,a[s++]=r++,a[s++]=e,a[s++]=r;for(a[s++]=r,a[s++]=e++,a[s++]=e,a[s++]=r++,a[s++]=e++,a[s++]=e,++e,n=t-1;n>1;--n){for(a[s++]=e++,a[s++]=e,a[s++]=r,o=2*n,i=0;i<o-1;++i)a[s++]=r,a[s++]=e++,a[s++]=e,a[s++]=r++,a[s++]=e,a[s++]=r;a[s++]=e++,a[s++]=e++,a[s++]=r++}for(n=0;n<3;n++)a[s++]=e++,a[s++]=e,a[s++]=r;return a}var L=new n.o;var R=new o.i,j=new o.i;function z(t){var i=t.center,f=t.ellipsoid,A=t.semiMajorAxis,I=n.o.multiplyByScalar(f.geodeticSurfaceNormal(i,x),t.height,x);R.center=n.o.add(i,I,R.center),R.radius=A,I=n.o.multiplyByScalar(f.geodeticSurfaceNormal(i,I),t.extrudedHeight,I),j.center=n.o.add(i,I,j.center),j.radius=A;var L=u.C.computeEllipsePositions(t,!0,!0),z=L.positions,G=L.numPts,V=L.outerPositions,k=o.i.union(R,j),Y=S(z,t,!0),B=C(G),H=B.length;B.length=2*H;for(var $=z.length/3,U=0;U<H;U+=3)B[U+H]=B[U+2]+$,B[U+1+H]=B[U+1]+$,B[U+2+H]=B[U]+$;var W=y.IndexDatatype.createTypedArray(2*$/3,B),q=new m.I({attributes:Y,indices:W,primitiveType:h._0x5194da.TRIANGLES}),Q=function(t,i){var u=i.vertexFormat,c=i.center,d=i.semiMajorAxis,y=i.semiMinorAxis,f=i.ellipsoid,A=i.height,I=i.extrudedHeight,S=i.stRotation,C=t.length/3*2,L=new Float64Array(3*C),R=u.st?new Float32Array(2*C):void 0,j=u.normal?new Float32Array(3*C):void 0,z=u.tangent?new Float32Array(3*C):void 0,G=u.bitangent?new Float32Array(3*C):void 0,V=i.shadowVolume,k=V?new Float32Array(3*C):void 0,Y=0,B=N,H=M,$=E,U=new o.n(f),W=U.project(f.cartesianToCartographic(c,P),D),q=f.scaleToGeodeticSurface(c,x);f.geodeticSurfaceNormal(q,q);for(var Q=m.n.fromAxisAngle(q,S,T),J=h.p$1.fromQuaternion(Q,w),Z=r.o.fromElements(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,F),K=r.o.fromElements(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,O),X=t.length,tt=X/3*2,et=0;et<X;et+=3){var ot,rt=et+1,nt=et+2,it=n.o.fromArray(t,et,x);if(u.st){var at=h.p$1.multiplyByVector(J,it,g),st=U.project(f.cartesianToCartographic(at,P),_);n.o.subtract(st,W,st),b.x=(st.x+d)/(2*d),b.y=(st.y+y)/(2*y),Z.x=Math.min(b.x,Z.x),Z.y=Math.min(b.y,Z.y),K.x=Math.max(b.x,K.x),K.y=Math.max(b.y,K.y),R[Y+tt]=b.x,R[Y+1+tt]=b.y,R[Y++]=b.x,R[Y++]=b.y}it=f.scaleToGeodeticSurface(it,it),ot=n.o.clone(it,g),B=f.geodeticSurfaceNormal(it,B),V&&(k[et+X]=-B.x,k[rt+X]=-B.y,k[nt+X]=-B.z);var ut=n.o.multiplyByScalar(B,A,v);if(it=n.o.add(it,ut,it),ut=n.o.multiplyByScalar(B,I,ut),ot=n.o.add(ot,ut,ot),u.position&&(L[et+X]=ot.x,L[rt+X]=ot.y,L[nt+X]=ot.z,L[et]=it.x,L[rt]=it.y,L[nt]=it.z),u.normal||u.tangent||u.bitangent){$=n.o.clone(B,$);var mt=n.o.fromArray(t,(et+3)%X,v);n.o.subtract(mt,it,mt);var lt=n.o.subtract(ot,it,_);B=n.o.normalize(n.o.cross(lt,mt,B),B),u.normal&&(j[et]=B.x,j[rt]=B.y,j[nt]=B.z,j[et+X]=B.x,j[rt+X]=B.y,j[nt+X]=B.z),u.tangent&&(H=n.o.normalize(n.o.cross($,B,H),H),z[et]=H.x,z[rt]=H.y,z[nt]=H.z,z[et+X]=H.x,z[et+1+X]=H.y,z[et+2+X]=H.z),u.bitangent&&(G[et]=$.x,G[rt]=$.y,G[nt]=$.z,G[et+X]=$.x,G[rt+X]=$.y,G[nt+X]=$.z)}}if(u.st){X=R.length;for(var ct=0;ct<X;ct+=2)R[ct]=(R[ct]-Z.x)/(K.x-Z.x),R[ct+1]=(R[ct+1]-Z.y)/(K.y-Z.y)}var pt=new l.a;if(u.position&&(pt.position=new m.o({componentDatatype:a.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:L})),u.st&&(pt.st=new m.o({componentDatatype:a.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:R})),u.normal&&(pt.normal=new m.o({componentDatatype:a.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:j})),u.tangent&&(pt.tangent=new m.o({componentDatatype:a.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:z})),u.bitangent&&(pt.bitangent=new m.o({componentDatatype:a.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:G})),V&&(pt.extrudeDirection=new m.o({componentDatatype:a.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:k})),s.e(i.offsetAttribute)){var dt=new Uint8Array(C);if(i.offsetAttribute===p.z.TOP)dt=e.d(dt,1,0,C/2);else{var yt=i.offsetAttribute===p.z.NONE?0:1;dt=e.d(dt,yt)}pt.applyOffset=new m.o({componentDatatype:a.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:dt})}return pt}(V,t);B=function(t){for(var e=t.length/3,o=y.IndexDatatype.createTypedArray(e,6*e),r=0,n=0;n<e;n++){var i=n,a=n+e,s=(i+1)%e,u=s+e;o[r++]=i,o[r++]=a,o[r++]=s,o[r++]=s,o[r++]=a,o[r++]=u}return o}(V);var J=y.IndexDatatype.createTypedArray(2*V.length/3,B),Z=new m.I({attributes:Q,indices:J,primitiveType:h._0x5194da.TRIANGLES}),K=d.k.combineInstances([new c.d({geometry:q}),new c.d({geometry:Z})]);return{boundingSphere:k,attributes:K[0].attributes,indices:K[0].indices}}function G(t,e,o,i,a,s,m){for(var l=u.C.computeEllipsePositions({center:t,semiMajorAxis:e,semiMinorAxis:o,rotation:i,granularity:a},!1,!0).outerPositions,c=l.length/3,p=new Array(c),d=0;d<c;++d)p[d]=n.o.fromArray(l,3*d);var y=r.h.fromCartesianArray(p,s,m);return y.width>f.e.PI&&(y.north=y.north>0?f.e.PI_OVER_TWO-f.e.EPSILON7:y.north,y.south=y.south<0?f.e.EPSILON7-f.e.PI_OVER_TWO:y.south,y.east=f.e.PI,y.west=-f.e.PI),y}function V(t){var e=(t=s.u(t,s.u.EMPTY_OBJECT)).center,o=s.u(t.ellipsoid,r.t.WGS84),a=t.semiMajorAxis,u=t.semiMinorAxis,m=s.u(t.granularity,f.e.RADIANS_PER_DEGREE),l=s.u(t.vertexFormat,A.n.DEFAULT);if(i.o.defined("options.center",e),i.o.typeOf.number("options.semiMajorAxis",a),i.o.typeOf.number("options.semiMinorAxis",u),a<u)throw new i.t("semiMajorAxis must be greater than or equal to the semiMinorAxis.");if(m<=0)throw new i.t("granularity must be greater than zero.");var c=s.u(t.height,0),p=s.u(t.extrudedHeight,c);this._center=n.o.clone(e),this._semiMajorAxis=a,this._semiMinorAxis=u,this._ellipsoid=r.t.clone(o),this._rotation=s.u(t.rotation,0),this._stRotation=s.u(t.stRotation,0),this._height=Math.max(p,c),this._granularity=m,this._vertexFormat=A.n.clone(l),this._extrudedHeight=Math.min(p,c),this._shadowVolume=s.u(t.shadowVolume,!1),this._workerName="createEllipseGeometry",this._offsetAttribute=t.offsetAttribute,this._rectangle=void 0,this._textureCoordinateRotationPoints=void 0}V.packedLength=n.o.packedLength+r.t.packedLength+A.n.packedLength+9,V.pack=function(t,e,o){return i.o.defined("value",t),i.o.defined("array",e),o=s.u(o,0),n.o.pack(t._center,e,o),o+=n.o.packedLength,r.t.pack(t._ellipsoid,e,o),o+=r.t.packedLength,A.n.pack(t._vertexFormat,e,o),o+=A.n.packedLength,e[o++]=t._semiMajorAxis,e[o++]=t._semiMinorAxis,e[o++]=t._rotation,e[o++]=t._stRotation,e[o++]=t._height,e[o++]=t._granularity,e[o++]=t._extrudedHeight,e[o++]=t._shadowVolume?1:0,e[o]=s.u(t._offsetAttribute,-1),e};var k=new n.o,Y=new r.t,B=new A.n,H={center:k,ellipsoid:Y,vertexFormat:B,semiMajorAxis:void 0,semiMinorAxis:void 0,rotation:void 0,stRotation:void 0,height:void 0,granularity:void 0,extrudedHeight:void 0,shadowVolume:void 0,offsetAttribute:void 0};V.unpack=function(t,e,o){i.o.defined("array",t),e=s.u(e,0);var a=n.o.unpack(t,e,k);e+=n.o.packedLength;var u=r.t.unpack(t,e,Y);e+=r.t.packedLength;var m=A.n.unpack(t,e,B);e+=A.n.packedLength;var l=t[e++],c=t[e++],p=t[e++],d=t[e++],y=t[e++],f=t[e++],h=t[e++],x=1===t[e++],g=t[e];return s.e(o)?(o._center=n.o.clone(a,o._center),o._ellipsoid=r.t.clone(u,o._ellipsoid),o._vertexFormat=A.n.clone(m,o._vertexFormat),o._semiMajorAxis=l,o._semiMinorAxis=c,o._rotation=p,o._stRotation=d,o._height=y,o._granularity=f,o._extrudedHeight=h,o._shadowVolume=x,o._offsetAttribute=-1===g?void 0:g,o):(H.height=y,H.extrudedHeight=h,H.granularity=f,H.stRotation=d,H.rotation=p,H.semiMajorAxis=l,H.semiMinorAxis=c,H.shadowVolume=x,H.offsetAttribute=-1===g?void 0:g,new V(H))},V.computeRectangle=function(t,e){var o=(t=s.u(t,s.u.EMPTY_OBJECT)).center,n=s.u(t.ellipsoid,r.t.WGS84),a=t.semiMajorAxis,u=t.semiMinorAxis,m=s.u(t.granularity,f.e.RADIANS_PER_DEGREE),l=s.u(t.rotation,0);if(i.o.defined("options.center",o),i.o.typeOf.number("options.semiMajorAxis",a),i.o.typeOf.number("options.semiMinorAxis",u),a<u)throw new i.t("semiMajorAxis must be greater than or equal to the semiMinorAxis.");if(m<=0)throw new i.t("granularity must be greater than zero.");return G(o,a,u,l,m,n,e)},V.createGeometry=function(t){if(!(t._semiMajorAxis<=0||t._semiMinorAxis<=0)){var r=t._height,i=t._extrudedHeight,l=!f.e.equalsEpsilon(r,i,0,f.e.EPSILON2);t._center=t._ellipsoid.scaleToGeodeticSurface(t._center,t._center);var c,d={center:t._center,semiMajorAxis:t._semiMajorAxis,semiMinorAxis:t._semiMinorAxis,ellipsoid:t._ellipsoid,rotation:t._rotation,height:r,granularity:t._granularity,vertexFormat:t._vertexFormat,stRotation:t._stRotation};if(l)d.extrudedHeight=i,d.shadowVolume=t._shadowVolume,d.offsetAttribute=t._offsetAttribute,c=z(d);else if(c=function(t){var e=t.center;L=n.o.multiplyByScalar(t.ellipsoid.geodeticSurfaceNormal(e,L),t.height,L),L=n.o.add(e,L,L);var r=new o.i(L,t.semiMajorAxis),i=u.C.computeEllipsePositions(t,!0,!1),a=i.positions,s=i.numPts,m=S(a,t,!1),l=C(s);return{boundingSphere:r,attributes:m,indices:l=y.IndexDatatype.createTypedArray(a.length/3,l)}}(d),s.e(t._offsetAttribute)){var A=c.attributes.position.values.length,x=new Uint8Array(A/3),g=t._offsetAttribute===p.z.NONE?0:1;e.d(x,g),c.attributes.applyOffset=new m.o({componentDatatype:a.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:x})}return new m.I({attributes:c.attributes,indices:c.indices,primitiveType:h._0x5194da.TRIANGLES,boundingSphere:c.boundingSphere,offsetAttribute:t._offsetAttribute})}},V.createShadowVolume=function(t,e,o){var r=t._granularity,n=t._ellipsoid,i=e(r,n),a=o(r,n);return new V({center:t._center,semiMajorAxis:t._semiMajorAxis,semiMinorAxis:t._semiMinorAxis,ellipsoid:n,rotation:t._rotation,stRotation:t._stRotation,granularity:r,extrudedHeight:i,height:a,vertexFormat:A.n.POSITION_ONLY,shadowVolume:!0})},Object.defineProperties(V.prototype,{rectangle:{get:function(){return s.e(this._rectangle)||(this._rectangle=G(this._center,this._semiMajorAxis,this._semiMinorAxis,this._rotation,this._granularity,this._ellipsoid)),this._rectangle}},textureCoordinateRotationPoints:{get:function(){return s.e(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(t){var e=-t._stRotation;if(0===e)return[0,0,0,1,1,0];for(var o=u.C.computeEllipsePositions({center:t._center,semiMajorAxis:t._semiMajorAxis,semiMinorAxis:t._semiMinorAxis,rotation:t._rotation,granularity:t._granularity},!1,!0).outerPositions,r=o.length/3,i=new Array(r),a=0;a<r;++a)i[a]=n.o.fromArray(o,3*a);var s=t._ellipsoid,l=t.rectangle;return m.I._textureCoordinateRotationPoints(i,e,s,l)}(this)),this._textureCoordinateRotationPoints}}}),t.Y=V}));
