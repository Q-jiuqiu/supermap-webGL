define(["./AttributeCompression-8bd8a380","./EllipsoidTangentPlane-367859c8","./buildModuleUrl-26ebe74f","./Cartesian2-94d75d5d","./Cartographic-cd471038","./when-f4cab1fd","./TerrainEncoding-6d218b81","./IndexDatatype-1cff6ae5","./Math-d934ba6b","./FeatureDetection-fb5abd84","./OrientedBoundingBox-146886ae","./Check-5cf5e906","./GeometryAttribute-acc7fc74","./WebMercatorProjection-ac4417ee","./createTaskProcessorWorker","./Cartesian4-d3cdbab5","./IntersectionTests-74b7d43a","./Plane-07f90ae1","./Event-73ce694f","./RuntimeError-e6b88f4d","./ComponentDatatype-509ef64d","./WebGLConstants-42651efd","./PolygonPipeline-846242d7","./EllipsoidRhumbLine-f8cea347"],(function(e,t,r,n,i,o,a,s,h,d,c,u,I,l,m,g,T,f,v,y,p,w,E,N){"use strict";function b(){u.t.throwInstantiationError()}Object.defineProperties(b.prototype,{errorEvent:{get:u.t.throwInstantiationError},credit:{get:u.t.throwInstantiationError},tilingScheme:{get:u.t.throwInstantiationError},ready:{get:u.t.throwInstantiationError},readyPromise:{get:u.t.throwInstantiationError},hasWaterMask:{get:u.t.throwInstantiationError},hasVertexNormals:{get:u.t.throwInstantiationError},availability:{get:u.t.throwInstantiationError}});var S=[];b.getRegularGridIndices=function(e,t){if(e*t>=h.e.FOUR_GIGABYTES)throw new u.t("The total number of vertices (width * height) must be less than 4,294,967,296.");var r=S[e];o.e(r)||(S[e]=r=[]);var n=r[t];return o.e(n)||F(e,t,n=e*t<h.e.SIXTY_FOUR_KILOBYTES?r[t]=new Uint16Array((e-1)*(t-1)*6+3*(e+t-2)):r[t]=new Uint32Array((e-1)*(t-1)*6+3*(e+t-2)),0),n},b.getRegularGridIndicesForReproject=function(e,t){if(e*t>=h.e.FOUR_GIGABYTES)throw new u.t("The total number of vertices (width * height) must be less than 4,294,967,296.");var r=S[e];o.e(r)||(S[e]=r=[]);var n=r[t];return o.e(n)||F(e,t,n=e*t<h.e.SIXTY_FOUR_KILOBYTES?r[t]=new Uint16Array((e-1)*(t-1)*6):r[t]=new Uint32Array((e-1)*(t-1)*6),0),n};var A=[];b.getRegularGridIndicesAndEdgeIndices=function(e,t){if(e*t>=h.e.FOUR_GIGABYTES)throw new u.t("The total number of vertices (width * height) must be less than 4,294,967,296.");var r=A[e];o.e(r)||(A[e]=r=[]);var n=r[t];if(!o.e(n)){var i=b.getRegularGridIndices(e,t),a=_(e,t),s=a.westIndicesSouthToNorth,d=a.southIndicesEastToWest,c=a.eastIndicesNorthToSouth,I=a.northIndicesWestToEast;n=r[t]={indices:i,westIndicesSouthToNorth:s,southIndicesEastToWest:d,eastIndicesNorthToSouth:c,northIndicesWestToEast:I}}return n};var x=[];function _(e,t){var r,n=new Array(t),i=new Array(e),o=new Array(t),a=new Array(e);for(r=0;r<e;++r)a[r]=r,i[r]=e*t-1-r;for(r=0;r<t;++r)o[r]=(r+1)*e-1,n[r]=(t-r-1)*e;return{westIndicesSouthToNorth:n,southIndicesEastToWest:i,eastIndicesNorthToSouth:o,northIndicesWestToEast:a}}function F(e,t,r,n){for(var i=0,o=0;o<t-1;++o){for(var a=0;a<e-1;++a){var s=i,h=s+e,d=h+1,c=s+1;r[n++]=s,r[n++]=h,r[n++]=c,r[n++]=c,r[n++]=h,r[n++]=d,++i}++i}var u=(t-1)/2,I=(e-1)/2;i=0;for(a=0;a<I;a++)r[n++]=i,r[n++]=i+1,r[n++]=i+2,i+=2;i=e*(t-1);for(a=0;a<I;a++)r[n++]=i+1,r[n++]=i,r[n++]=i+2,i+=2;i=0;for(a=0;a<u;a++)r[n++]=i+e,r[n++]=i,r[n++]=i+2*e,i+=2*e;i=e-1;for(a=0;a<u;a++)r[n++]=i,r[n++]=i+e,r[n++]=i+2*e,i+=2*e}function M(e,t,r,n,i){for(var a=o.e(i),s=e[0],h=e.length,d=1;d<h;++d){var c=e[d];!a||i[s+"_"+c]?(r[n++]=s,r[n++]=c,r[n++]=t,r[n++]=t,r[n++]=c,r[n++]=t+1,s=c,++t):(s=c,++t)}return n}b.getRegularGridAndSkirtIndicesAndEdgeIndices=function(e,t){if(e*t>=h.e.FOUR_GIGABYTES)throw new u.t("The total number of vertices (width * height) must be less than 4,294,967,296.");var r=x[e];o.e(r)||(x[e]=r=[]);var n=r[t];if(!o.e(n)){var i=e*t,a=(e-1)*(t-1)*6,d=2*e+2*t,c=i+d,I=3*(e+t-2),l=a+6*Math.max(0,d-4)+I,m=_(e,t),g=m.westIndicesSouthToNorth,T=m.southIndicesEastToWest,f=m.eastIndicesNorthToSouth,v=m.northIndicesWestToEast,y=s.IndexDatatype.createTypedArray(c,l);F(e,t,y,0),b.addSkirtIndices(g,T,f,v,i,y,a+I),n=r[t]={indices:y,westIndicesSouthToNorth:g,southIndicesEastToWest:T,eastIndicesNorthToSouth:f,northIndicesWestToEast:v,indexCountWithoutSkirts:a}}return n},b.addSkirtIndices=function(e,t,r,n,i,o,a,s){var h=i;a=M(e,h,o,a,s),a=M(t,h+=e.length,o,a,s),a=M(r,h+=t.length,o,a,s),M(n,h+=r.length,o,a,s)},b.heightmapTerrainQuality=.25,b.getEstimatedLevelZeroGeometricErrorForAHeightmap=function(e,t,r){return 2*e.maximumRadius*Math.PI*b.heightmapTerrainQuality/(t*r)},b.prototype.requestTileGeometry=u.t.throwInstantiationError,b.prototype.getLevelMaximumGeometricError=u.t.throwInstantiationError,b.prototype.getTileDataAvailable=u.t.throwInstantiationError,b.prototype.loadTileDataAvailability=u.t.throwInstantiationError;var P=32767,G=new i.o,B=new i.o,W=new i.o,O=new i.a,Y=new n.o,k=new i.o,C=new d.p,H=new d.p;function R(e,t,r,n,o,a,s,c,u){var I=Number.POSITIVE_INFINITY,l=o.north,m=o.south,g=o.east,T=o.west;g<T&&(g+=h.e.TWO_PI);for(var f=e.length,v=0;v<f;++v){var y=e[v],p=r[y],w=n[y];O.longitude=h.e.lerp(T,g,w.x),O.latitude=h.e.lerp(m,l,w.y),O.height=p-t;var E=a.cartographicToCartesian(O,G);d.p.multiplyByPoint(s,E,E),i.o.minimumByComponent(E,c,c),i.o.maximumByComponent(E,u,u),I=Math.min(I,O.height)}return I}function V(t,r,n,a,s,c,u,m,g,T,f,v,y,p,w){var E=o.e(u),N=g.north,b=g.south,S=g.east,A=g.west;S<A&&(S+=h.e.TWO_PI);for(var x=n.length,_=0;_<x;++_){var F=n[_],M=s[F],P=c[F];O.longitude=h.e.lerp(A,S,P.x)+p,O.latitude=h.e.lerp(b,N,P.y)+w,O.height=M-T;var B,W=m.cartographicToCartesian(O,G);if(E){var R=2*F;if(Y.x=u[R],Y.y=u[R+1],1!==f){var V=e.t.octDecode(Y.x,Y.y,k),U=I.m.eastNorthUpToFixedFrame(G,m,H),z=d.p.inverseTransformation(U,C);d.p.multiplyByPointAsVector(z,V,V),V.z*=f,i.o.normalize(V,V),d.p.multiplyByPointAsVector(U,V,V),i.o.normalize(V,V),e.t.octEncode(V,Y)}}a.hasWebMercatorT&&(B=(l.t.geodeticLatitudeToMercatorAngle(O.latitude)-v)*y),r=a.encode(t,r,W,P,O.height,Y,B)}}function U(e,t){var r;return"function"==typeof e.slice&&"function"!=typeof(r=e.slice()).sort&&(r=void 0),o.e(r)||(r=Array.prototype.slice.call(e)),r.sort(t),r}var z=m((function(u,m){var g,T,f=u.quantizedVertices,v=f.length/3,y=u.octEncodedNormals,p=u.westIndices.length+u.eastIndices.length+u.southIndices.length+u.northIndices.length,w=u.includeWebMercatorT,E=n.h.clone(u.rectangle),N=E.west,S=E.south,A=E.east,x=E.north,_=n.t.clone(u.ellipsoid),F=u.exaggeration,M=u.minimumHeight*F,z=u.maximumHeight*F,L=o.e(u.validMinimumHeight)?u.validMinimumHeight*F:M*F,D=o.e(u.validMaximumHeight)?u.validMaximumHeight*F:z*F,j=u.relativeToCenter,q=I.m.eastNorthUpToFixedFrame(j,_),K=d.p.inverseTransformation(q,new d.p);w&&(g=l.t.geodeticLatitudeToMercatorAngle(S),T=1/(l.t.geodeticLatitudeToMercatorAngle(x)-g));var Q=f.subarray(0,v),X=f.subarray(v,2*v),Z=f.subarray(2*v,3*v),J=o.e(y),$=new Array(v),ee=new Array(v),te=new Array(v),re=w?new Array(v):[],ne=B;ne.x=Number.POSITIVE_INFINITY,ne.y=Number.POSITIVE_INFINITY,ne.z=Number.POSITIVE_INFINITY;var ie=W;ie.x=Number.NEGATIVE_INFINITY,ie.y=Number.NEGATIVE_INFINITY,ie.z=Number.NEGATIVE_INFINITY;for(var oe=Number.POSITIVE_INFINITY,ae=Number.NEGATIVE_INFINITY,se=Number.POSITIVE_INFINITY,he=Number.NEGATIVE_INFINITY,de=0;de<v;++de){var ce=Q[de],ue=X[de],Ie=ce/P,le=ue/P,me=h.e.lerp(M,z,Z[de]/P);O.longitude=h.e.lerp(N,A,Ie),O.latitude=h.e.lerp(S,x,le),O.height=me,oe=Math.min(O.longitude,oe),ae=Math.max(O.longitude,ae),se=Math.min(O.latitude,se),he=Math.max(O.latitude,he);var ge=_.cartographicToCartesian(O);$[de]=new n.o(Ie,le),ee[de]=me,te[de]=ge,w&&(re[de]=(l.t.geodeticLatitudeToMercatorAngle(O.latitude)-g)*T),d.p.multiplyByPoint(K,ge,G),i.o.minimumByComponent(G,ne,ne),i.o.maximumByComponent(G,ie,ie)}var Te,fe,ve=U(u.westIndices,(function(e,t){return $[e].y-$[t].y})),ye=U(u.eastIndices,(function(e,t){return $[t].y-$[e].y})),pe=U(u.southIndices,(function(e,t){return $[t].x-$[e].x})),we=U(u.northIndices,(function(e,t){return $[e].x-$[t].x}));fe=r.i.fromPoints(te),Te=c.y.fromRectangle(E,M,z,_);var Ee,Ne=c.y.fromRectangle(E,L,D,_);(1!==F||M<0)&&(Ee=new a.s(_).computeHorizonCullingPointPossiblyUnderEllipsoid(j,te,M));var be=M;be=Math.min(be,R(u.westIndices,u.westSkirtHeight,ee,$,E,_,K,ne,ie)),be=Math.min(be,R(u.southIndices,u.southSkirtHeight,ee,$,E,_,K,ne,ie)),be=Math.min(be,R(u.eastIndices,u.eastSkirtHeight,ee,$,E,_,K,ne,ie)),be=Math.min(be,R(u.northIndices,u.northSkirtHeight,ee,$,E,_,K,ne,ie));for(var Se=new t.e(ne,ie,j),Ae=new a.h(Se,be,z,q,J,w),xe=Ae.getStride(),_e=new Float32Array(v*xe+p*xe),Fe=0,Me=0;Me<v;++Me){if(J){var Pe=2*Me;if(Y.x=y[Pe],Y.y=y[Pe+1],1!==F){var Ge=e.t.octDecode(Y.x,Y.y,k),Be=I.m.eastNorthUpToFixedFrame(te[Me],_,H),We=d.p.inverseTransformation(Be,C);d.p.multiplyByPointAsVector(We,Ge,Ge),Ge.z*=F,i.o.normalize(Ge,Ge),d.p.multiplyByPointAsVector(Be,Ge,Ge),i.o.normalize(Ge,Ge),e.t.octEncode(Ge,Y)}}Fe=Ae.encode(_e,Fe,te[Me],$[Me],ee[Me],Y,re[Me])}var Oe=Math.max(0,2*(p-4)),Ye=u.indices.length+3*Oe,ke=s.IndexDatatype.createTypedArray(v+p,Ye);ke.set(u.indices,0);var Ce=1e-4,He=(ae-oe)*Ce,Re=(he-se)*Ce,Ve=-He,Ue=He,ze=Re,Le=-Re,De=v*xe;V(_e,De,ve,Ae,ee,$,y,_,E,u.westSkirtHeight,F,g,T,Ve,0),V(_e,De+=u.westIndices.length*xe,pe,Ae,ee,$,y,_,E,u.southSkirtHeight,F,g,T,0,Le),V(_e,De+=u.southIndices.length*xe,ye,Ae,ee,$,y,_,E,u.eastSkirtHeight,F,g,T,Ue,0),V(_e,De+=u.eastIndices.length*xe,we,Ae,ee,$,y,_,E,u.northSkirtHeight,F,g,T,0,ze);var je=function(e,t,r,n){if(n<12)return;for(var i={},o=e.length,a=0;a<o;a+=3){var s=e[a],h=e[a+1],d=e[a+2];(t[s]===P&&t[h]===P||0===t[s]&&0===t[h]||r[s]===P&&r[h]===P||0===r[s]&&0===r[h])&&(i[s+"_"+h]=1,i[h+"_"+s]=1),(t[h]===P&&t[d]===P||0===t[h]&&0===t[d]||r[h]===P&&r[d]===P||0===r[h]&&0===r[d])&&(i[h+"_"+d]=1,i[d+"_"+h]=1),(t[d]===P&&t[s]===P||0===t[d]&&0===t[s]||r[d]===P&&r[s]===P||0===r[d]&&0===r[s])&&(i[d+"_"+s]=1,i[s+"_"+d]=1)}return i}(u.indices,Q,X,u.level);return b.addSkirtIndices(ve,pe,ye,we,v,ke,u.indices.length,je),m.push(_e.buffer,ke.buffer),{vertices:_e.buffer,indices:ke.buffer,westIndicesSouthToNorth:ve,southIndicesEastToWest:pe,eastIndicesNorthToSouth:ye,northIndicesWestToEast:we,vertexStride:xe,center:j,minimumHeight:M,maximumHeight:z,boundingSphere:fe,orientedBoundingBox:Te,validOrientedBoundingBox:Ne,occludeePointInScaledSpace:Ee,encoding:Ae,indexCountWithoutSkirts:u.indices.length}}));return z}));
